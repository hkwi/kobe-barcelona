---
title: はじめに
category: blog
layout: page
---

このサイトは神戸市・バルセロナ市連携プロジェクト[World Data Viz Challenge 2016](http://kobe-barcelona.net/) に向けて制作を始めました。

これまで何度も国勢調査に回答したことはあるけれども、その結果がどうなったのかを真面目に見たことはありませんでした。
国勢調査の結果から導かれた個別のトピックについて、ニュースなどで時折目にする程度でしょうか。
例えばよくあるグラフはこんな感じです。神戸市の「[平成27年12月1歳階級別人口](https://data.city.kobe.lg.jp/data/dataset/dataset-00000021/resource/0223309c-be7b-49b9-9f8d-865ede8ffbaf)」を使っていて、横軸が年齢（1歳刻みで0～100歳）、縦軸が人数です。
<div id="kobe_pop" style="height:250px; width:500px"></div>
<script src="{{ "/assets/d3.min.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/assets/d3plus.js" | prepend: site.baseurl }}"></script>
<script>
var rdata=[11689, 12169, 12339, 12543, 12796, 13070, 13030, 13258, 13040, 13201, 12986, 13286, 13729, 13804, 13742, 14220, 14123, 14354, 14241, 15036, 14747, 15567, 15357, 15771, 15737, 16219, 16082, 16457, 16726, 17041, 17242, 18149, 18279, 18211, 18224, 18546, 19220, 20467, 21054, 21687, 23076, 24519, 25629, 24825, 24635, 23988, 23335, 23004, 22743, 16605, 21751, 20560, 19963, 19425, 18603, 18570, 18650, 18664, 17302, 18230, 17942, 18365, 19680, 20330, 21558, 22897, 26983, 27357, 26598, 17184, 15631, 19360, 19549, 19261, 19843, 17413, 14831, 14119, 15497, 14425, 14589, 12579, 12381, 11941, 10005, 8987, 8102, 7318, 6069, 5436, 4583, 3628, 2835, 2374, 1814, 1465, 913, 760, 521, 356, 708]
var kobe_pop = []
for(var i=0; i<rdata.length; i++){
	kobe_pop.push({name:"神戸市人口", "人数":rdata[i], "年齢":i});
}
d3plus.viz().container("#kobe_pop").data(kobe_pop).type("bar")
.id("name")
.y("人数")
.x("年齢")
.draw()
</script>

どうも統計というと「大きな話」しかなくて、自分自身との距離を感じるのです。
もちろん統計結果には回答した内容が組み込まれているし、自分自身が統計データの一部に入っているはずなのですが、
当事者意識は持ちにくいと感じていました。

今回データを見ているうちに、公開されているデータ自体にはもっと情報が入っていることに気が付きました。先ほどの1歳階級のデータは「○○丁目」レベルでデータがあります。神戸市に住んでいる人であれば、それはどのぐらいの大きさなのか、ピンとくると思います。ほとんどのケースで、自動車を使わなくてもぐるりと回れる大きさではないでしょうか。どうにか工夫して、個人レベル（自分）と市レベル（全体）の間をうまくつないで見せることもできそうです。

数値処理をして色をつけて地図上に表示したものが、「[Kobe picker]({{"/app/2016/05/10/kobe.html" | prepend: site.baseurl}})」です。色の付け方については後述しますが、おおざっぱには赤が高齢寄り、緑が子育て世代になります。青はその中間です。自分が住んでいる場所の付近を眺めてみたり、マンション群や団地を見て「あぁ、この辺はどんな人が住んでいるんだろう？」となったときに様子がわかります。バルセロナ市版は「[Barcelona picker]({{"/app/2016/05/10/barcelona.html" | prepend: site.baseurl}})」です。バルセロナの赤は、神戸ほど強く高齢者に偏っていないことに注意して見てください。バルセロナのデータは[オープンデータ](http://opendata.bcn.cat/opendata/ca/catalog/DEMOGRAFIA/tpob-cp02/)（住民登録情報ベースのもの）を使っています。

また、過去分と合わせてアニメーション化したものが「[Kobe animation]({{"/app/2016/05/11/animation-kobe.html" | prepend: site.baseurl }})」と「[Barcelona animation]({{"/app/2016/05/11/animation-barcelona.html" | prepend: site.baseurl }})」のエントリです。


数値処理
-------
[NMF](https://en.wikipedia.org/wiki/Non-negative_matrix_factorization)を使っています。3ベクトルに分解していますが、着色はRGBの3次元だからという理由だけでそうしています。より大きくすると、二峰性（親子のペア）のベクトルが世代をずれていくつかでてくる感じです。ベクトルと色の対応は、ベクトルの平均年齢降順に赤、青、緑としています。

具体的な計算は[プログラムを参照](http://github.com/hkwi/kobe-barcelona)していただけると簡単かと思います。プログラムは主に python で前処理しています。[SciPy stack 互換のディストリビューション](https://www.scipy.org/install.html)を使うと簡単です。
